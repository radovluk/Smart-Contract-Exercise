\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{geometry}

\usepackage{minted} % For advanced code listings

% Define a custom minted style (optional)
\usemintedstyle{colorful} % You can choose from various styles like 'monokai', 'tango', 'colorful', etc.

% Custom color setup
\definecolor{bashtextcolor}{RGB}{0, 0, 0} % Define black color

% Define a new command for inline code using minted
\newcommand{\codeinline}[1]{\mintinline{text}{#1}}

\geometry{a4paper, margin=1in}

\title{Smart Contracts Exercise 01: \\ Hello, Blockchain World!}
\author{}
\date{}

% Define a new command for inline code with a dark background
\newcommand{\codeblack}[1]{%
  \texttt{\colorbox{black!7}{\textcolor{black}{#1}}}%
}

% Define a new command for inline code with a dark background
\newcommand{\codegrey}[1]{%
  \texttt{\colorbox{black!4}{\textcolor{black}{#1}}}%
}

% Define custom colors (optional)
\definecolor{myURLColor}{RGB}{0, 102, 204} % Example: A shade of blue

\hypersetup{
    colorlinks=true,        % Enable colored links
    linkcolor=blue,         % Color for internal links (e.g., \ref, \cite)
    citecolor=blue,         % Color for citations
    filecolor=magenta,      % Color for file links
    urlcolor=myURLColor     % Color for external URLs
}

% Define a style for code listings
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{lightgray!20},   
    commentstyle=\color{green!50!black},
    keywordstyle=\color{blue},
    numberstyle=\tiny\color{gray},
    stringstyle=\color{red},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstset{style=mystyle}
% Adding package for header and footer
\usepackage{fancyhdr}
\pagestyle{fancy}

% Define header and footer
\fancyhf{} % Clear current settings
\fancyhead[L]{Smart Contracts Exercise 01} % Left header
\fancyhead[R]{\thepage} % Right header with page number

\renewcommand{\headrulewidth}{0.4pt} % Line below header
% \renewcommand{\footrulewidth}{0.4pt} % Line above footer

\begin{document}

\maketitle
Welcome to the first smart contracts exercise! In this first exercise, you will become familiar with the basics of smart contract development. The goal is to create a simple smart contract. You will then compile, test, and deploy this smart contract in the local network environment, and subsequently deploy it to the live blockchain.

\section{Task: Set Up Hardhat Environment}

In this task, you will set up the Hardhat development environment on your machine. Hardhat is a development environment for Ethereum software. It provides a suite of tools for editing, compiling, debugging, and deploying your smart contracts and decentralized applications.

\begin{itemize}
    \item \textbf{Tip 1:} If you are using Windows, we strongly recommend using Windows Subsystem for Linux (WSL) to follow this guide. For more information, refer to the \href{https://learn.microsoft.com/en-us/windows/wsl/about}{official documentation}.
    
    \item \textbf{Tip 2:} If you are using Visual Studio Code, consider installing the \href{https://marketplace.visualstudio.com/items?itemName=JuanBlanco.solidity}{Visual Studio Code Solidity Extension}. This extension helps your development process by providing features like syntax highlighting, code completion, etc.
\end{itemize}


\subsection{Prerequisites}
Before setting up Hardhat, ensure that you have the following installed on your system:

\begin{itemize}
    \item \textbf{Node.js} - \url{https://nodejs.org/en/}
    An open-source, cross-platform, back-end JavaScript runtime environment that runs on the V8 engine and executes JavaScript code outside a web browser. 
    \item \textbf{NPM}: Node Package Manager, which comes with Node.js.
\end{itemize}

Open your terminal and run the following commands to verify the installations:

\begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{bash}
$ node -v
$ npm -v
\end{minted}

Both commands should return the installed version numbers of Node.js and NPM respectively. Node.js provides the runtime environment required to execute JavaScript-based tools like Hardhat, while NPM is used to manage the packages and dependencies needed for development. It is recommended that you use NPM 7 or higher.

\subsection{Creating a New Hardhat Project}

Create an empty working directory and then run the following commands to initialize a Hardhat project:

\begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{bash}
$ npm init -y # Initialize an npm project in the directory.
$ npm install --save-dev hardhat # Install Hardhat in the directory.
$ npx hardhat init # Initialize a Hardhat project.
\end{minted}
Select \codegrey{Create an empty \texttt{hardhat.config.js}} with your keyboard and hit enter.

\section{Task: Writing Your First Smart Contract}

Start by creating a new directory inside your project called \texttt{contracts} and create a file inside the directory called \texttt{Greeter.sol}. Paste the code below into the file and take a minute to read the code.

\begin{minted}[frame=lines, bgcolor=gray!5, fontsize=\footnotesize]{solidity}
// contracts/Greeter.sol

// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

/**
 * @title Greeter
 * @dev A simple smart contract that stores a greeting message.
 */
contract Greeter {
    // State variable to store the greeting message
    string private greeting;

    /**
     * @dev Constructor that initializes the contract with a greeting.
     * @param _greeting The greeting message to be stored.
     */
    constructor(string memory _greeting) {
        greeting = _greeting;
    }

    /**
     * @dev Function to retrieve the greeting message.
     * @return The current greeting stored in the contract.
     */
    function greet() public view returns (string memory) {
        return greeting;
    }
}
\end{minted}

The Greeter contract is a simple Solidity smart contract that stores a greeting message, initializes it during deployment, and allows users to retrieve it via a public function. To compile the contract, run \codeblack{npx hardhat compile} in your terminal.

\begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{bash}
$ npx hardhat compile
Compiled 1 Solidity file successfully (evm target: paris).
\end{minted}

Hardhat compiled your Solidity smart contract and generated corresponding artifacts—including the contract's ABI, bytecode, and related metadata—which are stored in the \texttt{artifacts} folder.

\section{Task: Test your Smart Contract with Local \\ Hardhat Network}

\subsection{Set Up Hardhat-Toolbox Plugin}
In this task, you will write and execute a simple test case for the \texttt{Greeter} contract using Hardhat's local network. For this task, we will need the \texttt{@nomicfoundation/hardhat-toolbox} plugin. It integrates testing libraries, Ethers.js, and other deployment utilities. Run the following command in the directory to install the plugin:

\begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{bash}
$ npm install --save-dev @nomicfoundation/hardhat-toolbox
\end{minted}

To include the plugin in your Hardhat project, add the following to your \texttt{hardhat.config.js} file in the project directory so that it will look like this:

\begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{javascript}
// hardhat.config.js

require("@nomicfoundation/hardhat-toolbox");

/** @type import('hardhat/config').HardhatUserConfig */
module.exports = {
  solidity: "0.8.0",
};
\end{minted}
For more information about plugins and how to test contracts in Hardhat, visit: \\ \href{https://hardhat.org/docs}{Hardhat Documentation}.

\subsection{Writing a Simple Test}

Create a new directory named \texttt{test} in your project root and add a file called \texttt{Greeter.js} with the following content:

\begin{minted}[frame=lines, bgcolor=gray!5, fontsize=\footnotesize]{javascript}
// test/Greeter.js

// Import the 'expect' function from Chai for assertions
const { expect } = require("chai");

// Test suite for the Greeter contract
describe("Greeter contract says Hello, Blockchain World!", function () {
  
  // Test to ensure the initial greeting is set correctly upon deployment
  it("Deployment should set the initial greeting correctly.", async function () {
    
    // Define the initial greeting message
    const initialGreeting = "Hello, Blockchain World!";
    
    // Deploy the Greeter contract with the initial greeting
    const greeter = await ethers.deployContract("Greeter", [initialGreeting]);
    
    // Wait for the deployment to complete
    await greeter.waitForDeployment();

    // Retrieve the stored greeting from the contract
    const greeting = await greeter.greet();

    // Verify that the retrieved greeting matches the initial greeting
    expect(greeting).to.equal(initialGreeting);
  });
});
\end{minted}

\subsection{Running the Test}

Execute the test on Hardhat's local network by running the following commands in your terminal:

\begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{bash}
$ npx hardhat test
\end{minted}
Congratulations! You wrote, compiled, and tested your first smart contract!

\section{Task: Deploying to a Live Network}

Once you have programmed and tested your dApp, you want to deploy it to a public blockchain so that others can access it. For the purposes of our exercise, we will not use the Ethereum mainnet because we would have to pay with real money, but instead use a live testnet. A testnet mimics real-world scenarios without risking our own money. Ethereum has several \href{https://ethereum.org/en/developers/docs/networks/#ethereum-testnets}{testnets}; for our purposes, we will choose the \href{https://sepolia.dev/}{Sepolia testnet}. Deploying to a testnet is the same as deploying to mainnet at the software level. The only difference is the network you connect to.

\subsection{Prerequisites}

In order to finish this task, you will need the following tools:

\begin{itemize}
    \item \textbf{MetaMask}: A popular Ethereum wallet that allows you to interact with the Ethereum blockchain. You can download the MetaMask extension for your browser from the \href{https://metamask.io/}{official website} and set it up. But you can also use other wallets or simply create your own private-public key pair.
    
    \item \textbf{Infura API Key}: Infura provides access to Ethereum nodes without the need to run your own. Sign up at \href{https://infura.io/}{Infura} to obtain an API key.
    
    \item \textbf{Sepolia Faucet}: Acquire Sepolia test Ether (ETH) from a faucet to fund your deployment. Some reliable faucets include:
    \begin{itemize}
        \item \href{https://cloud.google.com/application/web3/faucet/ethereum/sepolia}{Google Cloud Web3}
        \item \href{https://docs.metamask.io/developer-tools/faucet/}{Metamask Sepolia Faucet}
        \item \href{https://www.alchemy.com/faucets/ethereum-sepolia}{Alchemy Sepolia Faucet}
    \end{itemize}
\end{itemize}


\subsection{Configuring Hardhat for Sepolia Deployment}

To deploy your smart contract to the Sepolia testnet, you need to configure Hardhat with the network details and your wallet credentials.

\subsubsection{Storing Sensitive Information}

It's crucial to keep sensitive information like your private key and Infura API key secure. We recommend using environment variables to manage these credentials.

\begin{itemize}

\item Install the dotenv Package:
    
    \begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{bash}
    $ npm install dotenv --save
    \end{minted}
    
\item Create a \texttt{.env} file in your directory:

    In the root of your project directory, create a file named \texttt{.env} and add the following content:

    \begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{bash}
    # .env
    
    INFURA_API_KEY=your_infura_project_id
    SEPOLIA_PRIVATE_KEY=your_metamask_private_key
    \end{minted}
\end{itemize}

\begin{itemize}
    \item \textbf{Warning 1}: Never commit your \texttt{.env} file to version control. Add \texttt{.env} to your \texttt{.gitignore} file to prevent accidental exposure.

    \item \textbf{Warning 2}: Never store your private keys as plain text, even in your \texttt{.env} file. Use secure key management tools. However, for the purpose of our exercise, we will use environment variables. \textbf{Never use your private key associated with real money in plain text!}
\end{itemize}

\subsubsection{Updating \texttt{hardhat.config.js}}

Modify your \texttt{hardhat.config.js} file to include the Sepolia network configuration:

\begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{javascript}
// hardhat.config.js

require("@nomicfoundation/hardhat-toolbox");
require("dotenv").config();

/** @type import('hardhat/config').HardhatUserConfig */
module.exports = {
  solidity: "0.8.0",
  networks: {
    sepolia: {
      url: `https://sepolia.infura.io/v3/${process.env.INFURA_API_KEY}`,
      accounts: [`0x${process.env.SEPOLIA_PRIVATE_KEY}`],
    },
  },
};
\end{minted}

This configuration tells Hardhat how to connect to the Sepolia testnet using your Infura API key and deploy contracts using your wallet's private key.

\subsection{Deploying the Smart Contract to Sepolia}

With the configuration in place, you're ready to deploy your smart contract to the Sepolia testnet.

\subsubsection{Creating a Deployment Script}

\begin{itemize}
\item 1. Create a \texttt{scripts} Directory: In your project root, create a new directory named \texttt{scripts}.

\item 2. Add a Deployment Script: Inside the \texttt{scripts} directory, create a file named \texttt{deploy.js} and add the following content:
\end{itemize}

\begin{minted}[frame=lines, bgcolor=gray!5, fontsize=\footnotesize]{javascript}
// scripts/deploy.js

const hre = require("hardhat");

async function main() {
    // Set the initial greeting message
    const initialGreeting = "Hello, Blockchain World!";
    
    // Deploy the Greeter contract with the initial greeting
    const greeter = await ethers.deployContract("Greeter", [initialGreeting]);
    console.log(`Greeter contract deployed to: ${greeter.target}`);

    // Wait for the deployment to complete
    await greeter.waitForDeployment();

    // Retrieve the stored greeting from the contract
    const greeting = await greeter.greet();
    console.log(`Contract greeting: ${greeting}`);
}

main()
    .then(() => process.exit(0))
    .catch((error) => {
        console.error(error);
        process.exit(1);
    });
\end{minted}

\subsubsection{Executing the Deployment}

Run the deployment script using Hardhat with the Sepolia network specified:

\begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{bash}
$ npx hardhat run scripts/deploy.js --network sepolia
\end{minted}
Expected Output:
\begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{bash}
Greeter contract deployed to: <ContractAddress>
Contract greeting: Hello, Blockchain World!
\end{minted}
You can verify the deployment by visiting the Sepolia Etherscan explorer and searching for your contract address: \url{https://sepolia.etherscan.io/address/<ContractAddress>}. Search also for your account address and see your interactions with the deployed contract.

\subsection{Interacting with Your Deployed Contract}

Now that your contract is live on the Sepolia testnet, you can interact with it using various tools:

\begin{itemize}
    \item \textbf{Etherscan}: View contract details, read functions, and execute transactions directly from the Etherscan interface.
    
    \item \textbf{Web3 Interfaces}: Integrate your contract with frontend applications using libraries like \texttt{ethers.js} or \texttt{web3.js}.
    
    \item \textbf{Hardhat Tasks}: Write scripts or use the Hardhat console to interact programmatically with your contract.
\end{itemize}
Tip: If you run the deployment script without specifying the \texttt{--network} parameter, it will deploy to the local Hardhat network.
\begin{minted}[bgcolor=gray!5, fontsize=\footnotesize]{bash}
$ npx hardhat run scripts/deploy.js
\end{minted}

\subsection{Further Reading}

For more detailed information, refer to the following resources:

\begin{itemize}
    \item \href{https://docs.soliditylang.org/en/v0.8.0/}{Solidity Documentation}
    \item \href{https://hardhat.org/docs}{Hardhat Documentation}
    \item \href{https://www.chaijs.com/}{Chai Assertion Library}

\end{itemize}
Congratulations! You have successfully deployed your first smart contract to the live blockchain network! Stay tuned for the upcoming exercises!

\end{document}
